<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ä¸»å·¥ä½œå° - è½©æ…§å·¥ä½œå°</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/pages.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
    <button class="mobile-menu-toggle" id="mobile-menu-toggle" onclick="toggleMobileMenu()">â˜°</button>
    <div class="mobile-overlay" id="mobile-overlay" onclick="toggleMobileMenu()"></div>
    
    <div class="main-layout">
        <!-- ä¾§è¾¹æ  -->
        <div class="main-sidebar" id="main-sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">è½©æ…§å·¥ä½œå°</div>
            </div>
            
            <ul class="sidebar-nav">
                <li class="sidebar-nav-item">
                    <a class="sidebar-nav-link active" href="#retail" id="nav-retail" style="display:none;">
                        <span style="margin-right:10px;">ğŸ’°</span>é›¶å”®æ”¶é“¶
                    </a>
                    <a class="sidebar-nav-link active" href="#restaurant" id="nav-restaurant" style="display:none;">
                        <span style="margin-right:10px;">ğŸ½ï¸</span>æ¡Œå°ç®¡ç†
                    </a>
                </li>
                <li class="sidebar-nav-item">
                    <a class="sidebar-nav-link" href="#products">
                        <span style="margin-right:10px;">ğŸ“¦</span>å•†å“ç®¡ç†
                    </a>
                </li>
                <li class="sidebar-nav-item">
                    <a class="sidebar-nav-link" href="#members">
                        <span style="margin-right:10px;">ğŸ‘¤</span>ä¼šå‘˜ç®¡ç†
                    </a>
                </li>
                <li class="sidebar-nav-item">
                    <a class="sidebar-nav-link" href="#reports">
                        <span style="margin-right:10px;">ğŸ“Š</span>æ•°æ®æŠ¥è¡¨
                    </a>
                </li>
                <li class="sidebar-nav-item">
                    <a class="sidebar-nav-link" href="settings.html">
                        <span style="margin-right:10px;">âš™ï¸</span>ç³»ç»Ÿè®¾ç½®
                    </a>
                </li>
                <li class="sidebar-nav-item" style="position:absolute;bottom:20px;width:100%;">
                    <a class="sidebar-nav-link" href="login.html">
                        <span style="margin-right:10px;">ğŸšª</span>é€€å‡ºç™»å½•
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <!-- é›¶å”®æ”¶é“¶è§†å›¾ -->
            <div id="retail-view" style="display:none;">
                <div class="content-header">
                    <h2>é›¶å”®æ”¶é“¶</h2>
                    <input type="text" id="barcode-input" placeholder="è¯·æ‰«ææˆ–è¾“å…¥å•†å“æ¡ç " style="width:300px;padding:8px 12px;border:2px dashed #d9d9d9;border-radius:4px;text-align:center;">
                </div>
                <div class="retail-layout" style="display:flex;">
                    <div class="retail-products" style="flex:1;">
                        <div id="retail-product-list"></div>
                    </div>
                    <div class="retail-order" style="width:350px;margin-left:20px;background:#fff;border-radius:8px;padding:20px;">
                        <div class="order-header" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:15px;border-bottom:1px solid #f0f0f0;">
                            <h3>å½“å‰è®¢å•</h3>
                            <button class="btn btn-sm" onclick="RetailManager.clearOrder()">æ¸…ç©º</button>
                        </div>
                        <div id="retail-order-list" class="order-items"></div>
                        <div id="retail-order-total"></div>
                        <button class="btn btn-primary btn-lg" onclick="RetailManager.showCheckoutModal()" style="width:100%;">ç»“è´¦</button>
                    </div>
                </div>
            </div>
            
            <!-- é¤é¥®ç®¡ç†è§†å›¾ -->
            <div id="restaurant-view" style="display:none;">
                <div class="content-header">
                    <h2>æ¡Œå°ç®¡ç†</h2>
                </div>
                <div style="display:flex;">
                    <div style="flex:1;">
                        <div id="restaurant-tables" style="margin-bottom:20px;"></div>
                        <div id="restaurant-products"></div>
                    </div>
                    <div style="width:400px;margin-left:20px;position:sticky;top:20px;height:fit-content;">
                        <div id="restaurant-order-panel"></div>
                    </div>
                </div>
            </div>
            
            <!-- å•†å“ç®¡ç†è§†å›¾ -->
            <div id="products-view" style="display:none;">
                <div class="content-header">
                    <h2>å•†å“ç®¡ç†</h2>
                    <button class="btn btn-primary" onclick="ProductsManager.showProductModal()">+ æ–°å¢å•†å“</button>
                </div>
                <div style="display:flex;">
                    <div style="width:200px;background:#fff;padding:20px;border-radius:8px;margin-right:20px;">
                        <div id="category-list"></div>
                    </div>
                    <div style="flex:1;">
                        <div id="product-list"></div>
                    </div>
                </div>
            </div>
            
            <!-- ä¼šå‘˜ç®¡ç†è§†å›¾ -->
            <div id="members-view" style="display:none;">
                <div class="content-header">
                    <h2>ä¼šå‘˜ç®¡ç†</h2>
                    <div style="display:flex;gap:10px;">
                        <button class="btn" onclick="MembersManager.showBalanceRecords()">ä½™é¢è®°å½•</button>
                        <button class="btn" onclick="MembersManager.showPointsRecords()">ç§¯åˆ†è®°å½•</button>
                        <button class="btn btn-primary" onclick="MembersManager.showMemberModal()">+ æ–°å¢ä¼šå‘˜</button>
                    </div>
                </div>
                <div id="member-list"></div>
            </div>
            
            <!-- æ•°æ®æŠ¥è¡¨è§†å›¾ -->
            <div id="reports-view" style="display:none;">
                <div class="content-header">
                    <h2>æ•°æ®æŠ¥è¡¨</h2>
                    <div style="display:flex;gap:10px;align-items:center;">
                        <div style="display:flex;gap:8px;background:#fff;padding:4px;border-radius:4px;border:1px solid #E0E0E0;">
                            <button class="btn" id="btn-view-today" style="margin:0;border:none;background:rgba(66,133,244,0.12);color:#4285F4;font-weight:500;" onclick="ReportsManager.renderTodayReport()">ä»Šæ—¥æŠ¥è¡¨</button>
                            <button class="btn" id="btn-view-history" style="margin:0;border:none;" onclick="ReportsManager.renderHistoryList()">å†å²è®°å½•</button>
                        </div>
                        <button class="btn btn-primary" id="btn-print-report" onclick="ReportsManager.printReport()">æ‰“å°æŠ¥è¡¨</button>
                        <button class="btn btn-primary" id="btn-export-report" onclick="ReportsManager.exportReport()">å¯¼å‡ºExcel</button>
                        <button class="btn btn-success" id="btn-day-end" onclick="ReportsManager.dayEnd()">æ—¥ç»“</button>
                    </div>
                </div>
                <div id="report-stats"></div>
                <div class="card" id="report-orders-card" style="display:none;">
                    <div class="card-header">
                        <h3>ä»Šæ—¥è®¢å•</h3>
                    </div>
                    <div id="report-orders"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="js/common.js"></script>
    <script src="js/Storage.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/products.js"></script>
    <script src="js/members.js"></script>
    <script src="js/retail.js"></script>
    <script src="js/restaurant.js"></script>
    <script src="js/reports.js"></script>
    
    <script>
        // åŠ¨æ€è·å–API URLï¼ˆåŸºäºå½“å‰é¡µé¢åœ°å€ï¼‰
        function getApiURL() {
            var protocol = window.location.protocol;
            var hostname = window.location.hostname;
            var port = window.location.port || '8888';
            return protocol + '//' + hostname + ':' + port + '/api';
        }
        
        // è®¾ç½®API URLï¼ˆå¿…é¡»å…ˆè®¾ç½®æ‰èƒ½è¯»å–é…ç½®ï¼‰
        Storage.setBaseURL(getApiURL());
        
        // æ£€æŸ¥åˆå§‹åŒ–çŠ¶æ€
        var config = AppData.getConfig();
        if (!config.initialized) {
            window.location.href = 'init.html';
        }
        
        // åˆå§‹åŒ–
        var businessMode = config.businessMode || 'retail';
        
        // å¦‚æœé…ç½®äº†é¤é¥®æ¨¡å¼ï¼Œæ˜¾ç¤ºæç¤ºå¹¶å¼ºåˆ¶ä½¿ç”¨é›¶å”®æ¨¡å¼
        if (businessMode === 'restaurant') {
            Message.warning('é¤é¥®æ¨¡å¼æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼');
            // æ›´æ–°é…ç½®ä¸ºé›¶å”®æ¨¡å¼
            config.businessMode = 'retail';
            AppData.saveConfig(config);
        }
        
        // æ˜¾ç¤ºå¯¹åº”çš„å¯¼èˆªï¼ˆåªæ˜¾ç¤ºé›¶å”®æ¨¡å¼ï¼‰
        var navRetail = document.getElementById('nav-retail');
        var navRestaurant = document.getElementById('nav-restaurant');
        
        navRetail.style.display = 'block';
        navRestaurant.style.display = 'none';
        showView('retail');
        
        // åˆå§‹åŒ–æ¨¡å—
        ProductsManager.init();
        MembersManager.init();
        ReportsManager.init();
        RetailManager.init();
        
        // ç§»åŠ¨ç«¯èœå•æ§åˆ¶
        function toggleMobileMenu() {
            var sidebar = document.getElementById('main-sidebar');
            var overlay = document.getElementById('mobile-overlay');
            if (sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
            } else {
                sidebar.classList.add('open');
                overlay.classList.add('active');
            }
        }
        
        window.toggleMobileMenu = toggleMobileMenu;
        
        // å¯¼èˆªåˆ‡æ¢
        document.addEventListener('click', function(e) {
            if (e.target.closest('.sidebar-nav-link')) {
                var link = e.target.closest('.sidebar-nav-link');
                var href = link.getAttribute('href');
                
                if (href.startsWith('#')) {
                    e.preventDefault();
                    var viewName = href.substring(1);
                    showView(viewName);
                    
                    // æ›´æ–°å¯¼èˆªçŠ¶æ€
                    document.querySelectorAll('.sidebar-nav-link').forEach(function(l) {
                        l.classList.remove('active');
                    });
                    link.classList.add('active');
                    
                    // ç§»åŠ¨ç«¯ï¼šåˆ‡æ¢è§†å›¾åå…³é—­èœå•
                    if (window.innerWidth <= 768) {
                        toggleMobileMenu();
                    }
                }
            }
        });
        
        // æ˜¾ç¤ºè§†å›¾
        function showView(viewName) {
            document.getElementById('retail-view').style.display = 'none';
            document.getElementById('restaurant-view').style.display = 'none';
            document.getElementById('products-view').style.display = 'none';
            document.getElementById('members-view').style.display = 'none';
            document.getElementById('reports-view').style.display = 'none';
            
            if (viewName === 'retail') {
                document.getElementById('retail-view').style.display = 'block';
                RetailManager.init();
            } else if (viewName === 'restaurant') {
                // é¤é¥®æ¨¡å¼ï¼šæ˜¾ç¤º"å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…"æç¤º
                var restaurantView = document.getElementById('restaurant-view');
                restaurantView.style.display = 'block';
                restaurantView.innerHTML = '<div style="text-align:center;padding:100px 20px;"><div style="font-size:120px;margin-bottom:30px;">ğŸš§</div><h2 style="color:#4285F4;margin-bottom:20px;font-weight:400;">é¤é¥®æ¨¡å¼</h2><p style="font-size:18px;color:#757575;margin-bottom:30px;">å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…</p><p style="color:#9E9E9E;font-size:14px;">æˆ‘ä»¬æ­£åœ¨åŠªåŠ›å¼€å‘é¤é¥®ç›¸å…³åŠŸèƒ½ï¼Œæ•¬è¯·æœŸå¾…åç»­æ›´æ–°</p></div>';
                Message.warning('é¤é¥®æ¨¡å¼æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼');
            } else if (viewName === 'products') {
                document.getElementById('products-view').style.display = 'block';
                ProductsManager.init();
            } else if (viewName === 'members') {
                document.getElementById('members-view').style.display = 'block';
                MembersManager.init();
            } else if (viewName === 'reports') {
                document.getElementById('reports-view').style.display = 'block';
                ReportsManager.init();
            }
        }
    </script>
</body>
</html>

