<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ç³»ç»Ÿè®¾ç½® - è½©æ…§å·¥ä½œå°</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/pages.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <div class="main-layout">
        <!-- ä¾§è¾¹æ  -->
        <div class="main-sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">è½©æ…§å·¥ä½œå°</div>
            </div>
            
            <ul class="sidebar-nav">
                <li class="sidebar-nav-item">
                    <a class="sidebar-nav-link" href="dashboard.html">
                        <span style="margin-right:10px;">ğŸ </span>è¿”å›ä¸»é¡µ
                    </a>
                </li>
                <li class="sidebar-nav-item">
                    <a class="sidebar-nav-link active">
                        <span style="margin-right:10px;">âš™ï¸</span>ç³»ç»Ÿè®¾ç½®
                    </a>
                </li>
                <li class="sidebar-nav-item" style="position:absolute;bottom:20px;width:100%;">
                    <a class="sidebar-nav-link" href="login.html">
                        <span style="margin-right:10px;">ğŸšª</span>é€€å‡ºç™»å½•
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <div class="shop-config-layout">
                <!-- é…ç½®å¯¼èˆª -->
                <div class="shop-config-sidebar">
                    <h3 style="margin-top:0;">è®¾ç½®</h3>
                    <ul class="config-nav">
                        <li class="config-nav-item">
                            <a class="config-nav-link active" onclick="showSettingsTab('system')">
                                ğŸ”§ ç³»ç»Ÿè®¾ç½®
                            </a>
                        </li>
                        <li class="config-nav-item">
                            <a class="config-nav-link" onclick="showSettingsTab('shop')">
                                ğŸª åº—é“ºé…ç½®
                            </a>
                        </li>
                        <li class="config-nav-item">
                            <a class="config-nav-link" onclick="showSettingsTab('recharge')">
                                ğŸ’° é¢„å­˜ä¼˜æƒ 
                            </a>
                        </li>
                    </ul>
                </div>
                
                <!-- é…ç½®å†…å®¹ -->
                <div class="config-content">
                    <!-- ç³»ç»Ÿè®¾ç½® -->
                    <div id="system-tab" class="config-tab">
                        <div class="config-section">
                            <h3>ç³»ç»Ÿè®¾ç½®</h3>
                            
                            <div class="form-group">
                                <label class="form-label">åº—é“ºåç§°</label>
                                <input type="text" id="system-shop-name" class="form-control">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">ä¸šåŠ¡æ¨¡å¼</label>
                                <select id="system-business-mode" class="form-control">
                                    <option value="retail">é›¶å”®æ¨¡å¼</option>
                                </select>
                                <small style="display:block;margin-top:8px;color:#757575;">é¤é¥®æ¨¡å¼æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…</small>
                                <small class="text-muted">åˆ‡æ¢ä¸šåŠ¡æ¨¡å¼åéœ€åˆ·æ–°é¡µé¢</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">æ”¯ä»˜æ–¹å¼</label>
                                <div id="payment-methods-list"></div>
                                <div style="display:flex;gap:10px;margin-top:10px;">
                                    <input type="text" id="new-payment-name" class="form-control" placeholder="æ”¯ä»˜æ–¹å¼åç§°">
                                    <button class="btn btn-primary" id="btn-add-payment">æ·»åŠ </button>
                                </div>
                            </div>
                            
                            <div style="margin-top:30px;">
                                <button class="btn btn-primary btn-lg" id="btn-save-system">ä¿å­˜è®¾ç½®</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- åº—é“ºé…ç½® -->
                    <div id="shop-tab" class="config-tab" style="display:none;">
                        <div class="config-section">
                            <h3>åŸºç¡€é…ç½®</h3>
                            
                            <div class="form-group">
                                <label class="form-label">ç¨ç‡ï¼ˆ%ï¼‰</label>
                                <input type="number" id="shop-tax-rate" class="form-control" placeholder="0" min="0" max="100" step="0.01">
                                <small class="text-muted">é›¶å”®æ¨¡å¼é»˜è®¤ç¨ç‡</small>
                            </div>
                            
                            <div style="margin-top:30px;">
                                <button class="btn btn-primary btn-lg" id="btn-save-shop">ä¿å­˜é…ç½®</button>
                            </div>
                        </div>
                        
                        <div class="config-section restaurant-settings" id="restaurant-settings" style="display:none;">
                            <h3>æ¡Œå°ç®¡ç†</h3>
                            
                            <div style="margin-bottom:30px;">
                                <h4 class="form-section-title">åŒºåŸŸç®¡ç†</h4>
                                <div id="areas-list"></div>
                                <div style="display:flex;gap:10px;margin-top:10px;">
                                    <input type="text" id="new-area-name" class="form-control" placeholder="åŒºåŸŸåç§°">
                                    <button class="btn btn-primary" id="btn-add-area">æ·»åŠ åŒºåŸŸ</button>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="form-section-title">æ¡Œå°ç®¡ç†</h4>
                                <div id="tables-list"></div>
                                <div style="display:flex;gap:10px;margin-top:15px;">
                                    <select id="new-table-area" class="form-control">
                                        <option value="">è¯·é€‰æ‹©åŒºåŸŸ</option>
                                    </select>
                                    <input type="text" id="new-table-number" class="form-control" placeholder="æ¡Œå°å·">
                                    <button class="btn btn-primary" id="btn-add-table">æ·»åŠ æ¡Œå°</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- é¢„å­˜ä¼˜æƒ é…ç½® -->
                    <div id="recharge-tab" class="config-tab" style="display:none;">
                        <div class="config-section">
                            <h3>é¢„å­˜ä¼˜æƒ é…ç½®</h3>
                            
                            <div class="form-group">
                                <label class="form-label">è¯´æ˜</label>
                                <div style="padding:10px;background:#f5f5f5;border-radius:4px;color:#757575;">
                                    <p>é…ç½®é¢„å­˜ä¼šå‘˜å……å€¼ä¼˜æƒ æ´»åŠ¨ã€‚ä¾‹å¦‚ï¼šå……100å…ƒèµ 10å…ƒï¼Œå……200å…ƒèµ 25å…ƒç­‰ã€‚</p>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">ä¼˜æƒ åˆ—è¡¨</label>
                                <div id="recharge-promotions-list"></div>
                                <div style="display:flex;gap:10px;margin-top:15px;flex-wrap:wrap;">
                                    <input type="number" id="new-recharge-amount" class="form-control" placeholder="å……å€¼é‡‘é¢ï¼ˆÂ¥ï¼‰" min="0.01" step="0.01" style="flex:1;min-width:150px;">
                                    <input type="number" id="new-bonus-amount" class="form-control" placeholder="èµ é€é‡‘é¢ï¼ˆÂ¥ï¼‰" min="0" step="0.01" style="flex:1;min-width:150px;">
                                    <button class="btn btn-primary" id="btn-add-recharge-promotion">æ·»åŠ ä¼˜æƒ </button>
                                </div>
                            </div>
                            
                            <div style="margin-top:30px;">
                                <button class="btn btn-primary btn-lg" id="btn-save-recharge">ä¿å­˜é…ç½®</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="js/common.js"></script>
    <script src="js/Storage.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/members.js"></script>
    <script src="js/settings.js"></script>
    
    <script>
        // åŠ¨æ€è·å–API URLï¼ˆåŸºäºå½“å‰é¡µé¢åœ°å€ï¼‰
        function getApiURL() {
            var protocol = window.location.protocol;
            var hostname = window.location.hostname;
            var port = window.location.port || '8888';
            return protocol + '//' + hostname + ':' + port + '/api';
        }
        
        // è®¾ç½®API URLï¼ˆå¿…é¡»å…ˆè®¾ç½®æ‰èƒ½è¯»å–é…ç½®ï¼‰
        Storage.setBaseURL(getApiURL());
        
        // æ£€æŸ¥åˆå§‹åŒ–çŠ¶æ€
        var config = AppData.getConfig();
        if (!config.initialized) {
            window.location.href = 'init.html';
        }
        
        // åˆå§‹åŒ–
        SettingsManager.init();
        
        // æ ¹æ®ä¸šåŠ¡æ¨¡å¼æ˜¾ç¤ºé¤å…è®¾ç½®
        // å¦‚æœå½“å‰æ˜¯é¤é¥®æ¨¡å¼ï¼Œæ˜¾ç¤ºæç¤ºå¹¶è‡ªåŠ¨åˆ‡æ¢ä¸ºé›¶å”®æ¨¡å¼
        if (config.businessMode === 'restaurant') {
            Message.warning('é¤é¥®æ¨¡å¼æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼');
            config.businessMode = 'retail';
            AppData.saveConfig(config);
            DOM.getElement('#system-business-mode').value = 'retail';
        }
        
        // éšè—é¤é¥®ç›¸å…³è®¾ç½®
        var restaurantSettings = document.getElementById('restaurant-settings');
        if (restaurantSettings) {
            restaurantSettings.style.display = 'none';
        }
        
        // åˆ‡æ¢æ ‡ç­¾
        function showSettingsTab(tab) {
            document.getElementById('system-tab').style.display = 'none';
            document.getElementById('shop-tab').style.display = 'none';
            document.getElementById('recharge-tab').style.display = 'none';
            
            document.querySelectorAll('.config-nav-link').forEach(function(l) {
                l.classList.remove('active');
            });
            
            if (tab === 'system') {
                document.getElementById('system-tab').style.display = 'block';
                document.querySelectorAll('.config-nav-link')[0].classList.add('active');
            } else if (tab === 'shop') {
                document.getElementById('shop-tab').style.display = 'block';
                document.querySelectorAll('.config-nav-link')[1].classList.add('active');
            } else if (tab === 'recharge') {
                document.getElementById('recharge-tab').style.display = 'block';
                document.querySelectorAll('.config-nav-link')[2].classList.add('active');
                SettingsManager.loadRechargePromotions();
            }
        }
    </script>
</body>
</html>

